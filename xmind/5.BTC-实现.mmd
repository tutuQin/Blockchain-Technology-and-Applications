flowchart LR
    A["区块链基础概念"]
    A1["账本模式"]
    A2["UTXO 与全节点"]
    A3["概率模型与挖矿"]
    A4["最长合法链与不可逆账本"]
    A5["自私挖矿"]

    A --> A1
    A --> A2
    A --> A3
    A --> A4
    A --> A5

    %% 账本模式分支
    A1 --> A1a["基于交易的账本模式"]
    A1a --> A1a1["以交易和 UTXO 为核心"]
    A1a1 --> A1a2["每笔交易：消耗旧 UTXO，产生新 UTXO"]
    A1a2 --> A1a3["易于检测双花：同一 UTXO 只能被花一次"]
    A1 --> A1b["基于账户的账本模式"]
    A1b --> A1b1["维护'账户 → 余额'映射"]
    A1b1 --> A1b2["交易：从账户 A 减余额，加到账户 B"]
    A1b2 --> A1b3["适合智能合约状态机（如以太坊）"]

    %% UTXO 与全节点分支
    A2 --> A2a["全节点维护 UTXO 集"]
    A2a --> A2a1["顺序执行区块：删除已花费 UTXO，加入新生成 UTXO"]
    A2a1 --> A2a2["验证新交易：输入在 UTXO 集、签名有效、不重复花费"]
    A2 --> A2b["total input = total output（含手续费）"]
    A2b --> A2b1["普通交易：输入总和 ≥ 输出总和，差额为矿工费"]
    A2b1 --> A2b2["coinbase 交易：区块补贴 + 手续费，受协议上限约束"]

    %% 概率模型与挖矿分支
    A3 --> A3a["伯努利试验"]
    A3a --> A3a1["单次哈希：成功 / 失败"]
    A3a1 --> A3a2["成功 = 找到满足目标的区块头"]
    A3 --> A3b["伯努利过程"]
    A3b --> A3b1["连续独立哈希尝试"]
    A3b1 --> A3b2["固定但极小的成功概率"]
    A3b2 --> A3b3["全网算力决定试验频率和平均出块率"]
    A3 --> A3c["无记忆性"]
    A3c --> A3c1["已等多久不影响下一分钟出块概率"]
    A3c1 --> A3c2["区块间隔近似指数分布的典型性质"]
    A3 --> A3d["泊松过程"]
    A3d --> A3d1["描述单位时间内产生多少区块"]
    A3d1 --> A3d2["区块数在时间区间内服从泊松分布"]
    A3 --> A3e["指数分布"]
    A3e --> A3e1["相邻两区块时间间隔服从指数分布"]
    A3e1 --> A3e2["平均出块时间约 10 分钟"]
    A3 --> A3f["无进展性"]
    A3f --> A3f1["过去哈希尝试不累积'进度'"]
    A3f1 --> A3f2["每次尝试独立，从零开始"]
    A3f2 --> A3f3["算力占比 ≈ 区块奖励占比"]
    A3 --> A3g["几何级数与安全性"]
    A3g --> A3g1["攻击者落后 k 区块的追上成功概率"]
    A3g1 --> A3g2["算力<50%时，确认数 k 越大，成功概率几何级数衰减"]

    %% 最长合法链与不可逆账本分支
    A4 --> A4a["最长合法链"]
    A4a --> A4a1["仅接受满足规则的合法区块"]
    A4a1 --> A4a2["分叉时选累计难度最高（最长）链"]
    A4a2 --> A4a3["矿工持续向最长链追加新块，短链被淘汰"]
    A4 --> A4b["不可逆账本"]
    A4b --> A4b1["理论可回滚但代价极高"]
    A4b1 --> A4b2["确认数增加→所需篡改工作量上升"]
    A4b2 --> A4b3["双花概率随确认数增加趋于0"]

    %% 自私挖矿分支
    A5 --> A5a["基本策略"]
    A5a --> A5a1["挖到新区块先不广播"]
    A5a1 --> A5a2["在私有链积累领先高度"]
    A5a2 --> A5a3["有利时机公布私有长链"]
    A5a3 --> A5a4["挤掉诚实矿工区块，收益超出算力占比"]
    A5 --> A5b["成功条件"]
    A5b --> A5b1["拥有较高算力（约三分之一以上）"]
    A5b1 --> A5b2["在网络传播上具有优势"]
    A5b2 --> A5b3["长期期望收益高于诚实挖矿"]
    A5 --> A5c["对系统影响"]
    A5c --> A5c1["影响奖励分配与去中心化"]
    A5c1 --> A5c2["多用浅层分叉，不重写深层历史"]
    A5c2 --> A5c3["协议与网络优化可降低其收益"]